---
import Layout from "../Layouts/Layout.astro";
import ArticleHeader from "../components/article/ArticleHeader.astro";
import ArticleAuthor from "../components/article/ArticleAuthor.astro";
import SocialShare from "../components/article/SocialShare.astro";
import ArticleImage from "../components/article/ArticleImage.astro";
import ArticleBodyVariant from "../components/article/ArticleBodyVariant.astro";
import RecentArticles from "../components/article/RecentArticles.astro";
import articleData from "../content/articlePage/RU/Article.json";

// Import all article images at once!
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/article_content/*.{jpeg,jpg,png,gif}",
  { eager: true }
);

// Prepare data with resolved image modules
const mainImageModule =
  images[`/src/assets/images/article_content/${articleData.mainImage.src}`]
    ?.default;

const relatedArticlesWithImages = await Promise.all(
  articleData.relatedArticles.map(async (article) => {
    const imageModule =
      images[`/src/assets/images/article_content/${article.image}`]?.default;
    return { ...article, image: imageModule };
  })
);

const tipsWithImages = await Promise.all(
  articleData.bodyVariant.tips.map(async (tip) => {
    const imageModule =
      images[`/src/assets/images/article_content/${tip.image}`]?.default;
    return { ...tip, image: imageModule };
  })
);
---

<Layout
  navbarVariant="default"
  includePreFooterCTA={false}
  title={`${articleData.header.title} (Вариант) - Maag`}
  useClientRouter={true}
>
  <main class="bg-base-200 min-h-screen">
    <div class="max-w-[1512px] mx-auto">
      <!-- Article Header Section -->
      <div class="pt-[150px] pb-[100px] flex flex-col items-center gap-[100px]">
        <div class="flex flex-col gap-8 max-w-[825px] w-full">
          <ArticleHeader
            category={articleData.header.category}
            title={articleData.header.title}
          />
          <ArticleAuthor
            name={articleData.author.name}
            avatarUrl={articleData.author.avatarUrl}
          />
          <SocialShare readTime={articleData.meta.readTime} />
        </div>

        {
          mainImageModule && (
            <ArticleImage
              src={mainImageModule}
              alt={articleData.mainImage.alt}
              caption={articleData.mainImage.caption}
            />
          )
        }
      </div>

      <!-- Article Content -->
      <div class="max-w-[1400px] mx-auto px-14 pb-[100px]">
        <ArticleBodyVariant
          opening={articleData.bodyVariant.opening}
          mainContent={articleData.bodyVariant.mainContent}
          tips={tipsWithImages}
        />
        <RecentArticles articles={relatedArticlesWithImages} />
      </div>
    </div>
  </main>
</Layout>
