---
import Button from "@/components/common/Button.astro";
import Input from "@/components/common/Input.astro";
---

<div
  x-data="$lazy('authModal')"
  x-show="$store.auth.isAuthModalOpen"
  @keydown.escape.window="$store.auth.closeAuthModal()"
  @value-changed.window="handleInputChange($event.detail)"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-200"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
  class="fixed inset-0 z-50 flex items-center justify-center"
  style="display: none;"
>
  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/50" @click="$store.auth.closeAuthModal()"></div>

  <!-- Modal Content -->
  <div
    x-show="$store.auth.isAuthModalOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
    class="relative bg-base-100 rounded-lg shadow-xl p-8 w-full max-w-md"
  >
    <!-- Login Form -->
    <template x-if="$store.auth.formType === 'login'">
      <form @submit.prevent="handleSubmit">
        <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
        <div class="space-y-4">
          <Input type="email" name="email" placeholder="Email" :value="formData.email" required />
          <Input type="password" name="password" placeholder="Password" :value="formData.password" required />
        </div>
        <div class="mt-6">
          <Button type="submit" class="w-full" :disabled="isLoading">
            <span x-show="!isLoading">Login</span>
            <span x-show="isLoading">Loading...</span>
          </Button>
        </div>
        <p class="text-sm text-center mt-4">
          Don't have an account? <button type="button" @click="$store.auth.switchTo('signup')" class="text-primary hover:underline">Sign up</button>
        </p>
      </form>
    </template>

    <!-- Signup Form -->
    <template x-if="$store.auth.formType === 'signup'">
      <form @submit.prevent="handleSubmit">
        <h2 class="text-2xl font-bold mb-6 text-center">Sign Up</h2>
        <div class="space-y-4">
          <Input type="text" name="firstName" placeholder="First Name" :value="formData.firstName" required />
          <Input type="text" name="lastName" placeholder="Last Name" :value="formData.lastName" required />
          <Input type="email" name="email" placeholder="Email" :value="formData.email" required />
          <Input type="password" name="password" placeholder="Password" :value="formData.password" required />
          <Input type="password" name="confirmPassword" placeholder="Confirm Password" :value="formData.confirmPassword" required />
        </div>
        <div class="mt-6">
          <Button type="submit" class="w-full" :disabled="isLoading">
            <span x-show="!isLoading">Sign Up</span>
            <span x-show="isLoading">Loading...</span>
          </Button>
        </div>
        <p class="text-sm text-center mt-4">
          Already have an account? <button type="button" @click="$store.auth.switchTo('login')" class="text-primary hover:underline">Login</button>
        </p>
      </form>
    </template>

    <!-- Error Message -->
    <template x-if="error">
      <p class="text-error text-sm text-center mt-4" x-text="error"></p>
    </template>
  </div>
</div>