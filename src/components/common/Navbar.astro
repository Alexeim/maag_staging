---
import logo from "../../assets/logo/logo.svg";
import { Search, Instagram, Youtube, X } from "@lucide/astro";
import { Image } from "astro:assets";
import searchIcon from "../../assets/icons/search-mobile.svg";
import burgerIcon from "../../assets/icons/burger-mobile.svg";
import Button from "./Button.astro";

interface NavbarProps {
  variant: "default" | "transparent";
  languages: string;
  user?: boolean;
  showLogoInNav?: boolean;
}

const {
  variant,
  languages,
  user = true,
  showLogoInNav = true,
} = Astro.props as NavbarProps;

const navbarClasses = variant === "default" ? "bg-base-100" : "bg-transparent";
const positionClasses = variant === "default" ? "relative" : "absolute";
const colorClasses = "text-base-content";
const borderClasses = "border-none";

const logoSrc = logo.src;
---

<header class:list={["w-full h-[80px] lg:h-[90px]", positionClasses]}>
  <!-- Background Layer -->
  <div class:list={["absolute inset-0 w-full h-full z-20", navbarClasses]}>
  </div>

  <!-- Content Layer -->
  <nav
    class:list={[
      "relative w-full h-full px-4 lg:px-[57px] flex items-center justify-between z-40",
      colorClasses,
      borderClasses,
    ]}
  >
    <!-- Left Side Group (Logo + Menu) -->
    <div class="flex items-center relative">
      {
        showLogoInNav && (
          <a class="cursor-pointer" href="/">
            <Image src={logo} alt="Maag logo" class="w-12 lg:w-16" />
          </a>
        )
      }
      <!-- Desktop Menu -->
      <div
        class="hidden lg:flex absolute top-1/2 left-full -translate-y-1/2 ml-12"
      >
        <ul class="flex items-center text-base-content whitespace-nowrap">
          <li
            class="nav-item font-old-standard uppercase tracking-[.46em] text-base font-normal hover:border-b hover:border-base-content pb-0.5"
          >
            <a href="/culture" class="">Культура</a>
          </li>
          <div class="w-[1px] h-[12px] bg-neutral-300 mx-6"></div>
          <li
            class="nav-item font-old-standard uppercase tracking-[.46em] text-base font-normal hover:border-b hover:border-base-content pb-0.5"
          >
            <a href="/paris" class="">Париж</a>
          </li>
          <div class="w-[1px] h-[12px] bg-neutral-300 mx-6"></div>
          <li
            class="nav-item font-old-standard uppercase tracking-[.46em] text-base font-normal hover:border-b hover:border-base-content pb-0.5"
          >
            <a href="/building" class="">Дети</a>
          </li>
          <div class="w-[1px] h-[12px] bg-neutral-300 mx-6"></div>
          <li
            class="nav-item font-old-standard uppercase tracking-[.46em] text-base font-normal hover:border-b hover:border-base-content pb-0.5"
          >
            <a href="/calendar" class="">Календарь</a>
          </li>
          <div class="w-[1px] h-[12px] bg-neutral-300 mx-6"></div>
          <li
            class="nav-item font-old-standard uppercase tracking-[.46em] text-base font-normal hover:border-b hover:border-base-content pb-0.5"
          >
            <a href="/building" class="">О проекте</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Mobile Controls -->
    <div class="flex items-center gap-4 lg:hidden">
      <button type="button" class="p-2">
        <Image src={searchIcon} alt="Search" class="h-5 w-5" />
      </button>
      <button
        type="button"
        class="p-2"
        @click="$store.navbar.toggle()"
        aria-controls="mobile-menu"
        x-bind:aria-expanded="$store.navbar.isOpen"
      >
        <Image src={burgerIcon} alt="Toggle navigation" class="h-5 w-5" />
      </button>
    </div>

    <!-- Right Side -->
    <div class="hidden lg:flex items-center gap-[19px]">
      <button class="p-2">
        <Image src={searchIcon} alt="Search" class="h-5 w-5" />
      </button>
      <button class="p-2">
        <Instagram class="h-6 w-6" />
      </button>
      <button class="p-2">
        <Youtube class="h-7 w-7" />
      </button>
      <div class="flex items-center gap-4" x-data>
        <!-- Loading State -->
        <template x-if="$store.auth.isLoading">
          <button class="btn btn-outline btn-primary" disabled>...</button>
        </template>
        <!-- Logged Out State -->
        <template x-if="!$store.auth.isLoading && !$store.auth.isLoggedIn">
          <button
            @click.prevent="$store.auth.openAuthModal()"
            class="border border-primary bg-primary text-primary-content rounded-[9px] py-1.5 px-4 text-center font-inter text-[14px] w-full cursor-pointer hover:bg-primary/80 transition-colors"
          >
            Войти
          </button>
        </template>
        <!-- Logged In State -->
        <template x-if="!$store.auth.isLoading && $store.auth.isLoggedIn">
          <div class="flex items-center gap-4">
            <a
              href="/profile"
              class="flex items-center justify-center w-10 h-10 bg-primary text-primary-content rounded-full font-bold text-lg hover:drop-shadow-lg transition-shadow"
            >
              <div x-text="$store.auth.initials"></div>
            </a>
            <button
              @click.prevent="signOut(auth)"
              class="btn btn-outline btn-primary"
            >
              Выйти
            </button>
          </div>
        </template>
      </div>
    </div>
  </nav>
</header>

<script>
  import { signOut } from "firebase/auth";
  import { auth } from "@/lib/firebase/client";

  // Make functions available to Alpine
  window.signOut = signOut;
  window.auth = auth;
</script>

<style>
  .nav-item {
    transition: none !important;
  }
  .nav-item:hover {
    transition: none !important;
  }
</style>
