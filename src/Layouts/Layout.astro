---
import "../styles/global.css";
import { ViewTransitions } from "astro:transitions";
import { Instagram, Youtube, X } from "@lucide/astro";

import Header from "../components/common/Header.astro";
import Footer from "../components/common/Footer.astro";
import AuthModal from "../components/auth/AuthModal.astro";
import Toast from "../components/common/Toast.astro";
import ConfirmationModal from "../components/common/ConfirmationModal.astro";
import { navbarContent } from "../content/navbar/RU/Navbar.json";
import { footerData } from "../content/footer/EN/Footer.json";

interface LayoutProps {
  title?: string;
  useClientRouter?: boolean;
  navbarVariant?: "default" | "transparent";
  includePreFooterCTA?: boolean;
}

const {
  title = "Maag",
  useClientRouter = false,
  navbarVariant = "default",
  includePreFooterCTA = true,
} = Astro.props as LayoutProps;
---

<!doctype html>
<html lang="en" data-theme="maag">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content="Wrukspaces.dev" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <ViewTransitions />
    <title>{title}</title>
  </head>
  <body class="bg-base-200" x-data>
    <Header
      variant={navbarVariant}
      cultureText={navbarContent.items[0].label}
      guideText={navbarContent.items[1].label}
      childrenText={navbarContent.items[2].label}
      calendarText={navbarContent.items[3].label}
      aboutText={navbarContent.items[4].label}
      languagesText={navbarContent.languages[0]}
      buttonText={navbarContent.button.label}
    />
    <slot />
    <Footer />

    <!-- Mobile Menu -->
    <!-- Overlay -->
    <div x-show="$store.navbar.isOpen" x-cloak @click="$store.navbar.close()" class="fixed inset-0 bg-black/30 z-[998] lg:hidden" x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-linear duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"></div>

    <!-- Panel -->
    <div id="mobile-menu" x-show="$store.navbar.isOpen" x-cloak class="fixed top-0 right-0 w-[235px] h-screen bg-base-100 z-[999] lg:hidden flex flex-col justify-between p-8" x-transition:enter="transform transition ease-in-out duration-300" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transform transition ease-in-out duration-300" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
      <!-- Links -->
      <ul class="flex flex-col gap-4 text-base-content">
        <li class="font-old-standard uppercase tracking-[.46em] text-base font-normal"><a href="/culture">Культура</a></li>
        <li class="font-old-standard uppercase tracking-[.46em] text-base font-normal"><a href="/paris">Париж</a></li>
        <li class="font-old-standard uppercase tracking-[.46em] text-base font-normal"><a href="/building">Дети</a></li>
        <li class="font-old-standard uppercase tracking-[.46em] text-base font-normal"><a href="/calendar">Календарь</a></li>
        <li class="font-old-standard uppercase tracking-[.46em] text-base font-normal"><a href="/building">О проекте</a></li>
      </ul>

      <!-- Bottom Section -->
      <div class="flex flex-col gap-7" x-data>
        <!-- Loading State -->
        <template x-if="$store.auth.isLoading">
          <button class="bg-primary text-primary-content rounded-[9px] py-1.5 text-center font-inter text-[14px] w-full" disabled>...</button>
        </template>
        <!-- Logged Out State -->
        <template x-if="!$store.auth.isLoading && !$store.auth.isLoggedIn">
          <button @click.prevent="$store.auth.openAuthModal(); $store.navbar.close()" class="bg-primary text-primary-content rounded-[9px] py-1.5 text-center font-inter text-[14px] w-full">Войти</button>
        </template>
        <!-- Logged In State -->
        <template x-if="!$store.auth.isLoading && $store.auth.isLoggedIn">
          <div class="flex flex-col items-center gap-4 w-full">
            <a href="/profile" class="flex items-center justify-center w-12 h-12 bg-primary text-primary-content rounded-full font-bold text-xl hover:drop-shadow-lg transition-shadow">
              <div x-text="$store.auth.initials"></div>
            </a>
            <button @click.prevent="signOut(auth); $store.navbar.close()" class="bg-transparent text-base-content/70 hover:text-base-content text-center font-inter text-[14px] w-full">Выйти</button>
          </div>
        </template>

        <div class="flex items-center justify-center gap-5">
          <a href="#"><Instagram class="h-6 w-6" /></a>
          <a href="#"><Youtube class="h-7 w-7" /></a>
          <a href="#"><X class="h-6 w-6" /></a>
        </div>
      </div>
    </div>

    <!-- Global Modals and Toasts -->
    <AuthModal />
    <Toast />
    <ConfirmationModal />

    <script>
      import { signOut } from 'firebase/auth';
      import { auth } from '@/lib/firebase/client';
      
      // Make functions available to Alpine
      window.signOut = signOut;
      window.auth = auth;

      // Close mobile menu on page navigation
      document.addEventListener('astro:after-swap', () => {
        if (window.Alpine && window.Alpine.store('navbar')) {
          window.Alpine.store('navbar').close();
        }
      });
    </script>
  </body>
</html>
